// Code generated by protoc-gen-gogo. DO NOT EDIT.
// source: model.proto

/*
	Package model is a generated protocol buffer package.

	It is generated from these files:
		model.proto

	It has these top-level messages:
		CookieProto
		TokenProto
		RefreshProto
		UserBaseProto
		UserEmailProto
		UserTelProto
		UserRegOriginProto
		UserSafeQuestionProto
		UserThirdBindProto
*/
package model

import proto "github.com/golang/protobuf/proto"
import fmt "fmt"
import math "math"
import _ "github.com/gogo/protobuf/gogoproto"

import io "io"

// Reference imports to suppress errors if they are not otherwise used.
var _ = proto.Marshal
var _ = fmt.Errorf
var _ = math.Inf

// This is a compile-time assertion to ensure that this generated file
// is compatible with the proto package it is being compiled against.
// A compilation error at this line likely means your copy of the
// proto package needs to be updated.
const _ = proto.ProtoPackageIsVersion2 // please upgrade the proto package

type CookieProto struct {
	Mid     int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	Session string `protobuf:"bytes,2,opt,name=Session,proto3" json:"session"`
	CSRF    string `protobuf:"bytes,3,opt,name=CSRF,proto3" json:"csrf"`
	Type    int64  `protobuf:"varint,4,opt,name=Type,proto3" json:"type"`
	Expires int64  `protobuf:"varint,5,opt,name=Expires,proto3" json:"expires"`
}

func (m *CookieProto) Reset()                    { *m = CookieProto{} }
func (m *CookieProto) String() string            { return proto.CompactTextString(m) }
func (*CookieProto) ProtoMessage()               {}
func (*CookieProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{0} }

func (m *CookieProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *CookieProto) GetSession() string {
	if m != nil {
		return m.Session
	}
	return ""
}

func (m *CookieProto) GetCSRF() string {
	if m != nil {
		return m.CSRF
	}
	return ""
}

func (m *CookieProto) GetType() int64 {
	if m != nil {
		return m.Type
	}
	return 0
}

func (m *CookieProto) GetExpires() int64 {
	if m != nil {
		return m.Expires
	}
	return 0
}

type TokenProto struct {
	Mid     int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	AppID   int64  `protobuf:"varint,2,opt,name=AppID,proto3" json:"appid"`
	Token   string `protobuf:"bytes,3,opt,name=Token,proto3" json:"token"`
	Type    int64  `protobuf:"varint,4,opt,name=Type,proto3" json:"type"`
	Expires int64  `protobuf:"varint,5,opt,name=Expires,proto3" json:"expires"`
}

func (m *TokenProto) Reset()                    { *m = TokenProto{} }
func (m *TokenProto) String() string            { return proto.CompactTextString(m) }
func (*TokenProto) ProtoMessage()               {}
func (*TokenProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{1} }

func (m *TokenProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *TokenProto) GetAppID() int64 {
	if m != nil {
		return m.AppID
	}
	return 0
}

func (m *TokenProto) GetToken() string {
	if m != nil {
		return m.Token
	}
	return ""
}

func (m *TokenProto) GetType() int64 {
	if m != nil {
		return m.Type
	}
	return 0
}

func (m *TokenProto) GetExpires() int64 {
	if m != nil {
		return m.Expires
	}
	return 0
}

type RefreshProto struct {
	Mid     int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	AppID   int64  `protobuf:"varint,2,opt,name=AppID,proto3" json:"appid"`
	Refresh string `protobuf:"bytes,3,opt,name=Refresh,proto3" json:"refresh"`
	Token   string `protobuf:"bytes,4,opt,name=Token,proto3" json:"token"`
	Expires int64  `protobuf:"varint,5,opt,name=Expires,proto3" json:"expires"`
}

func (m *RefreshProto) Reset()                    { *m = RefreshProto{} }
func (m *RefreshProto) String() string            { return proto.CompactTextString(m) }
func (*RefreshProto) ProtoMessage()               {}
func (*RefreshProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{2} }

func (m *RefreshProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *RefreshProto) GetAppID() int64 {
	if m != nil {
		return m.AppID
	}
	return 0
}

func (m *RefreshProto) GetRefresh() string {
	if m != nil {
		return m.Refresh
	}
	return ""
}

func (m *RefreshProto) GetToken() string {
	if m != nil {
		return m.Token
	}
	return ""
}

func (m *RefreshProto) GetExpires() int64 {
	if m != nil {
		return m.Expires
	}
	return 0
}

type UserBaseProto struct {
	Mid    int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	UserID string `protobuf:"bytes,2,opt,name=UserID,proto3" json:"userid"`
	Pwd    []byte `protobuf:"bytes,3,opt,name=Pwd,proto3" json:"pwd"`
	Salt   string `protobuf:"bytes,4,opt,name=Salt,proto3" json:"salt"`
	Status int32  `protobuf:"varint,5,opt,name=Status,proto3" json:"status"`
}

func (m *UserBaseProto) Reset()                    { *m = UserBaseProto{} }
func (m *UserBaseProto) String() string            { return proto.CompactTextString(m) }
func (*UserBaseProto) ProtoMessage()               {}
func (*UserBaseProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{3} }

func (m *UserBaseProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserBaseProto) GetUserID() string {
	if m != nil {
		return m.UserID
	}
	return ""
}

func (m *UserBaseProto) GetPwd() []byte {
	if m != nil {
		return m.Pwd
	}
	return nil
}

func (m *UserBaseProto) GetSalt() string {
	if m != nil {
		return m.Salt
	}
	return ""
}

func (m *UserBaseProto) GetStatus() int32 {
	if m != nil {
		return m.Status
	}
	return 0
}

type UserEmailProto struct {
	Mid           int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	Email         []byte `protobuf:"bytes,2,opt,name=Email,proto3" json:"email"`
	Verified      int32  `protobuf:"varint,3,opt,name=Verified,proto3" json:"verified"`
	EmailBindTime int64  `protobuf:"varint,4,opt,name=EmailBindTime,proto3" json:"email_bind_time"`
}

func (m *UserEmailProto) Reset()                    { *m = UserEmailProto{} }
func (m *UserEmailProto) String() string            { return proto.CompactTextString(m) }
func (*UserEmailProto) ProtoMessage()               {}
func (*UserEmailProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{4} }

func (m *UserEmailProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserEmailProto) GetEmail() []byte {
	if m != nil {
		return m.Email
	}
	return nil
}

func (m *UserEmailProto) GetVerified() int32 {
	if m != nil {
		return m.Verified
	}
	return 0
}

func (m *UserEmailProto) GetEmailBindTime() int64 {
	if m != nil {
		return m.EmailBindTime
	}
	return 0
}

type UserTelProto struct {
	Mid         int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	Tel         []byte `protobuf:"bytes,2,opt,name=Tel,proto3" json:"tel"`
	Cid         string `protobuf:"bytes,3,opt,name=Cid,proto3" json:"cid"`
	TelBindTime int64  `protobuf:"varint,4,opt,name=TelBindTime,proto3" json:"tel_bind_time"`
}

func (m *UserTelProto) Reset()                    { *m = UserTelProto{} }
func (m *UserTelProto) String() string            { return proto.CompactTextString(m) }
func (*UserTelProto) ProtoMessage()               {}
func (*UserTelProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{5} }

func (m *UserTelProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserTelProto) GetTel() []byte {
	if m != nil {
		return m.Tel
	}
	return nil
}

func (m *UserTelProto) GetCid() string {
	if m != nil {
		return m.Cid
	}
	return ""
}

func (m *UserTelProto) GetTelBindTime() int64 {
	if m != nil {
		return m.TelBindTime
	}
	return 0
}

type UserRegOriginProto struct {
	Mid      int64 `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	JoinIP   int64 `protobuf:"varint,2,opt,name=JoinIP,proto3" json:"join_ip"`
	JoinTime int64 `protobuf:"varint,3,opt,name=JoinTime,proto3" json:"join_time"`
	Origin   int32 `protobuf:"varint,4,opt,name=Origin,proto3" json:"origin"`
	RegType  int32 `protobuf:"varint,5,opt,name=RegType,proto3" json:"reg_type"`
	AppID    int64 `protobuf:"varint,6,opt,name=AppID,proto3" json:"appid"`
}

func (m *UserRegOriginProto) Reset()                    { *m = UserRegOriginProto{} }
func (m *UserRegOriginProto) String() string            { return proto.CompactTextString(m) }
func (*UserRegOriginProto) ProtoMessage()               {}
func (*UserRegOriginProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{6} }

func (m *UserRegOriginProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserRegOriginProto) GetJoinIP() int64 {
	if m != nil {
		return m.JoinIP
	}
	return 0
}

func (m *UserRegOriginProto) GetJoinTime() int64 {
	if m != nil {
		return m.JoinTime
	}
	return 0
}

func (m *UserRegOriginProto) GetOrigin() int32 {
	if m != nil {
		return m.Origin
	}
	return 0
}

func (m *UserRegOriginProto) GetRegType() int32 {
	if m != nil {
		return m.RegType
	}
	return 0
}

func (m *UserRegOriginProto) GetAppID() int64 {
	if m != nil {
		return m.AppID
	}
	return 0
}

type UserSafeQuestionProto struct {
	Mid          int64  `protobuf:"varint,1,opt,name=Mid,proto3" json:"mid"`
	SafeQuestion int32  `protobuf:"varint,2,opt,name=SafeQuestion,proto3" json:"safe_question"`
	SafeAnswer   []byte `protobuf:"bytes,3,opt,name=SafeAnswer,proto3" json:"safe_answer"`
	SafeBindTime int64  `protobuf:"varint,4,opt,name=SafeBindTime,proto3" json:"safe_bind_time"`
}

func (m *UserSafeQuestionProto) Reset()                    { *m = UserSafeQuestionProto{} }
func (m *UserSafeQuestionProto) String() string            { return proto.CompactTextString(m) }
func (*UserSafeQuestionProto) ProtoMessage()               {}
func (*UserSafeQuestionProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{7} }

func (m *UserSafeQuestionProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserSafeQuestionProto) GetSafeQuestion() int32 {
	if m != nil {
		return m.SafeQuestion
	}
	return 0
}

func (m *UserSafeQuestionProto) GetSafeAnswer() []byte {
	if m != nil {
		return m.SafeAnswer
	}
	return nil
}

func (m *UserSafeQuestionProto) GetSafeBindTime() int64 {
	if m != nil {
		return m.SafeBindTime
	}
	return 0
}

type UserThirdBindProto struct {
	ID       int64  `protobuf:"varint,1,opt,name=ID,proto3" json:"id"`
	Mid      int64  `protobuf:"varint,2,opt,name=Mid,proto3" json:"mid"`
	OpenID   string `protobuf:"bytes,3,opt,name=OpenID,proto3" json:"openid"`
	PlatForm int64  `protobuf:"varint,4,opt,name=PlatForm,proto3" json:"platform"`
	Token    string `protobuf:"bytes,5,opt,name=Token,proto3" json:"token"`
	Expires  int64  `protobuf:"varint,6,opt,name=Expires,proto3" json:"expires"`
}

func (m *UserThirdBindProto) Reset()                    { *m = UserThirdBindProto{} }
func (m *UserThirdBindProto) String() string            { return proto.CompactTextString(m) }
func (*UserThirdBindProto) ProtoMessage()               {}
func (*UserThirdBindProto) Descriptor() ([]byte, []int) { return fileDescriptorModel, []int{8} }

func (m *UserThirdBindProto) GetID() int64 {
	if m != nil {
		return m.ID
	}
	return 0
}

func (m *UserThirdBindProto) GetMid() int64 {
	if m != nil {
		return m.Mid
	}
	return 0
}

func (m *UserThirdBindProto) GetOpenID() string {
	if m != nil {
		return m.OpenID
	}
	return ""
}

func (m *UserThirdBindProto) GetPlatForm() int64 {
	if m != nil {
		return m.PlatForm
	}
	return 0
}

func (m *UserThirdBindProto) GetToken() string {
	if m != nil {
		return m.Token
	}
	return ""
}

func (m *UserThirdBindProto) GetExpires() int64 {
	if m != nil {
		return m.Expires
	}
	return 0
}

func init() {
	proto.RegisterType((*CookieProto)(nil), "passport.interface.login.CookieProto")
	proto.RegisterType((*TokenProto)(nil), "passport.interface.login.TokenProto")
	proto.RegisterType((*RefreshProto)(nil), "passport.interface.login.RefreshProto")
	proto.RegisterType((*UserBaseProto)(nil), "passport.interface.login.UserBaseProto")
	proto.RegisterType((*UserEmailProto)(nil), "passport.interface.login.UserEmailProto")
	proto.RegisterType((*UserTelProto)(nil), "passport.interface.login.UserTelProto")
	proto.RegisterType((*UserRegOriginProto)(nil), "passport.interface.login.UserRegOriginProto")
	proto.RegisterType((*UserSafeQuestionProto)(nil), "passport.interface.login.UserSafeQuestionProto")
	proto.RegisterType((*UserThirdBindProto)(nil), "passport.interface.login.UserThirdBindProto")
}
func (m *CookieProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *CookieProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if len(m.Session) > 0 {
		dAtA[i] = 0x12
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Session)))
		i += copy(dAtA[i:], m.Session)
	}
	if len(m.CSRF) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.CSRF)))
		i += copy(dAtA[i:], m.CSRF)
	}
	if m.Type != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Type))
	}
	if m.Expires != 0 {
		dAtA[i] = 0x28
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Expires))
	}
	return i, nil
}

func (m *TokenProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *TokenProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if m.AppID != 0 {
		dAtA[i] = 0x10
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.AppID))
	}
	if len(m.Token) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Token)))
		i += copy(dAtA[i:], m.Token)
	}
	if m.Type != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Type))
	}
	if m.Expires != 0 {
		dAtA[i] = 0x28
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Expires))
	}
	return i, nil
}

func (m *RefreshProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *RefreshProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if m.AppID != 0 {
		dAtA[i] = 0x10
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.AppID))
	}
	if len(m.Refresh) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Refresh)))
		i += copy(dAtA[i:], m.Refresh)
	}
	if len(m.Token) > 0 {
		dAtA[i] = 0x22
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Token)))
		i += copy(dAtA[i:], m.Token)
	}
	if m.Expires != 0 {
		dAtA[i] = 0x28
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Expires))
	}
	return i, nil
}

func (m *UserBaseProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserBaseProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if len(m.UserID) > 0 {
		dAtA[i] = 0x12
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.UserID)))
		i += copy(dAtA[i:], m.UserID)
	}
	if len(m.Pwd) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Pwd)))
		i += copy(dAtA[i:], m.Pwd)
	}
	if len(m.Salt) > 0 {
		dAtA[i] = 0x22
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Salt)))
		i += copy(dAtA[i:], m.Salt)
	}
	if m.Status != 0 {
		dAtA[i] = 0x28
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Status))
	}
	return i, nil
}

func (m *UserEmailProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserEmailProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if len(m.Email) > 0 {
		dAtA[i] = 0x12
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Email)))
		i += copy(dAtA[i:], m.Email)
	}
	if m.Verified != 0 {
		dAtA[i] = 0x18
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Verified))
	}
	if m.EmailBindTime != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.EmailBindTime))
	}
	return i, nil
}

func (m *UserTelProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserTelProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if len(m.Tel) > 0 {
		dAtA[i] = 0x12
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Tel)))
		i += copy(dAtA[i:], m.Tel)
	}
	if len(m.Cid) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Cid)))
		i += copy(dAtA[i:], m.Cid)
	}
	if m.TelBindTime != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.TelBindTime))
	}
	return i, nil
}

func (m *UserRegOriginProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserRegOriginProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if m.JoinIP != 0 {
		dAtA[i] = 0x10
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.JoinIP))
	}
	if m.JoinTime != 0 {
		dAtA[i] = 0x18
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.JoinTime))
	}
	if m.Origin != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Origin))
	}
	if m.RegType != 0 {
		dAtA[i] = 0x28
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.RegType))
	}
	if m.AppID != 0 {
		dAtA[i] = 0x30
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.AppID))
	}
	return i, nil
}

func (m *UserSafeQuestionProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserSafeQuestionProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.Mid != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if m.SafeQuestion != 0 {
		dAtA[i] = 0x10
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.SafeQuestion))
	}
	if len(m.SafeAnswer) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.SafeAnswer)))
		i += copy(dAtA[i:], m.SafeAnswer)
	}
	if m.SafeBindTime != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.SafeBindTime))
	}
	return i, nil
}

func (m *UserThirdBindProto) Marshal() (dAtA []byte, err error) {
	size := m.Size()
	dAtA = make([]byte, size)
	n, err := m.MarshalTo(dAtA)
	if err != nil {
		return nil, err
	}
	return dAtA[:n], nil
}

func (m *UserThirdBindProto) MarshalTo(dAtA []byte) (int, error) {
	var i int
	_ = i
	var l int
	_ = l
	if m.ID != 0 {
		dAtA[i] = 0x8
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.ID))
	}
	if m.Mid != 0 {
		dAtA[i] = 0x10
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Mid))
	}
	if len(m.OpenID) > 0 {
		dAtA[i] = 0x1a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.OpenID)))
		i += copy(dAtA[i:], m.OpenID)
	}
	if m.PlatForm != 0 {
		dAtA[i] = 0x20
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.PlatForm))
	}
	if len(m.Token) > 0 {
		dAtA[i] = 0x2a
		i++
		i = encodeVarintModel(dAtA, i, uint64(len(m.Token)))
		i += copy(dAtA[i:], m.Token)
	}
	if m.Expires != 0 {
		dAtA[i] = 0x30
		i++
		i = encodeVarintModel(dAtA, i, uint64(m.Expires))
	}
	return i, nil
}

func encodeVarintModel(dAtA []byte, offset int, v uint64) int {
	for v >= 1<<7 {
		dAtA[offset] = uint8(v&0x7f | 0x80)
		v >>= 7
		offset++
	}
	dAtA[offset] = uint8(v)
	return offset + 1
}
func (m *CookieProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	l = len(m.Session)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	l = len(m.CSRF)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Type != 0 {
		n += 1 + sovModel(uint64(m.Type))
	}
	if m.Expires != 0 {
		n += 1 + sovModel(uint64(m.Expires))
	}
	return n
}

func (m *TokenProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	if m.AppID != 0 {
		n += 1 + sovModel(uint64(m.AppID))
	}
	l = len(m.Token)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Type != 0 {
		n += 1 + sovModel(uint64(m.Type))
	}
	if m.Expires != 0 {
		n += 1 + sovModel(uint64(m.Expires))
	}
	return n
}

func (m *RefreshProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	if m.AppID != 0 {
		n += 1 + sovModel(uint64(m.AppID))
	}
	l = len(m.Refresh)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	l = len(m.Token)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Expires != 0 {
		n += 1 + sovModel(uint64(m.Expires))
	}
	return n
}

func (m *UserBaseProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	l = len(m.UserID)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	l = len(m.Pwd)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	l = len(m.Salt)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Status != 0 {
		n += 1 + sovModel(uint64(m.Status))
	}
	return n
}

func (m *UserEmailProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	l = len(m.Email)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Verified != 0 {
		n += 1 + sovModel(uint64(m.Verified))
	}
	if m.EmailBindTime != 0 {
		n += 1 + sovModel(uint64(m.EmailBindTime))
	}
	return n
}

func (m *UserTelProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	l = len(m.Tel)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	l = len(m.Cid)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.TelBindTime != 0 {
		n += 1 + sovModel(uint64(m.TelBindTime))
	}
	return n
}

func (m *UserRegOriginProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	if m.JoinIP != 0 {
		n += 1 + sovModel(uint64(m.JoinIP))
	}
	if m.JoinTime != 0 {
		n += 1 + sovModel(uint64(m.JoinTime))
	}
	if m.Origin != 0 {
		n += 1 + sovModel(uint64(m.Origin))
	}
	if m.RegType != 0 {
		n += 1 + sovModel(uint64(m.RegType))
	}
	if m.AppID != 0 {
		n += 1 + sovModel(uint64(m.AppID))
	}
	return n
}

func (m *UserSafeQuestionProto) Size() (n int) {
	var l int
	_ = l
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	if m.SafeQuestion != 0 {
		n += 1 + sovModel(uint64(m.SafeQuestion))
	}
	l = len(m.SafeAnswer)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.SafeBindTime != 0 {
		n += 1 + sovModel(uint64(m.SafeBindTime))
	}
	return n
}

func (m *UserThirdBindProto) Size() (n int) {
	var l int
	_ = l
	if m.ID != 0 {
		n += 1 + sovModel(uint64(m.ID))
	}
	if m.Mid != 0 {
		n += 1 + sovModel(uint64(m.Mid))
	}
	l = len(m.OpenID)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.PlatForm != 0 {
		n += 1 + sovModel(uint64(m.PlatForm))
	}
	l = len(m.Token)
	if l > 0 {
		n += 1 + l + sovModel(uint64(l))
	}
	if m.Expires != 0 {
		n += 1 + sovModel(uint64(m.Expires))
	}
	return n
}

func sovModel(x uint64) (n int) {
	for {
		n++
		x >>= 7
		if x == 0 {
			break
		}
	}
	return n
}
func sozModel(x uint64) (n int) {
	return sovModel(uint64((x << 1) ^ uint64((int64(x) >> 63))))
}
func (m *CookieProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: CookieProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: CookieProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Session", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Session = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field CSRF", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.CSRF = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Type", wireType)
			}
			m.Type = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Type |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 5:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Expires", wireType)
			}
			m.Expires = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Expires |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *TokenProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: TokenProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: TokenProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field AppID", wireType)
			}
			m.AppID = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.AppID |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Token", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Token = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Type", wireType)
			}
			m.Type = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Type |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 5:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Expires", wireType)
			}
			m.Expires = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Expires |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *RefreshProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: RefreshProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: RefreshProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field AppID", wireType)
			}
			m.AppID = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.AppID |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Refresh", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Refresh = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 4:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Token", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Token = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 5:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Expires", wireType)
			}
			m.Expires = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Expires |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserBaseProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserBaseProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserBaseProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field UserID", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.UserID = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Pwd", wireType)
			}
			var byteLen int
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				byteLen |= (int(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			if byteLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + byteLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Pwd = append(m.Pwd[:0], dAtA[iNdEx:postIndex]...)
			if m.Pwd == nil {
				m.Pwd = []byte{}
			}
			iNdEx = postIndex
		case 4:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Salt", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Salt = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 5:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Status", wireType)
			}
			m.Status = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Status |= (int32(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserEmailProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserEmailProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserEmailProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Email", wireType)
			}
			var byteLen int
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				byteLen |= (int(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			if byteLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + byteLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Email = append(m.Email[:0], dAtA[iNdEx:postIndex]...)
			if m.Email == nil {
				m.Email = []byte{}
			}
			iNdEx = postIndex
		case 3:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Verified", wireType)
			}
			m.Verified = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Verified |= (int32(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field EmailBindTime", wireType)
			}
			m.EmailBindTime = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.EmailBindTime |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserTelProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserTelProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserTelProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Tel", wireType)
			}
			var byteLen int
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				byteLen |= (int(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			if byteLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + byteLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Tel = append(m.Tel[:0], dAtA[iNdEx:postIndex]...)
			if m.Tel == nil {
				m.Tel = []byte{}
			}
			iNdEx = postIndex
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Cid", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Cid = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field TelBindTime", wireType)
			}
			m.TelBindTime = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.TelBindTime |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserRegOriginProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserRegOriginProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserRegOriginProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field JoinIP", wireType)
			}
			m.JoinIP = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.JoinIP |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 3:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field JoinTime", wireType)
			}
			m.JoinTime = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.JoinTime |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Origin", wireType)
			}
			m.Origin = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Origin |= (int32(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 5:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field RegType", wireType)
			}
			m.RegType = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.RegType |= (int32(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 6:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field AppID", wireType)
			}
			m.AppID = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.AppID |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserSafeQuestionProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserSafeQuestionProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserSafeQuestionProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field SafeQuestion", wireType)
			}
			m.SafeQuestion = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.SafeQuestion |= (int32(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field SafeAnswer", wireType)
			}
			var byteLen int
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				byteLen |= (int(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			if byteLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + byteLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.SafeAnswer = append(m.SafeAnswer[:0], dAtA[iNdEx:postIndex]...)
			if m.SafeAnswer == nil {
				m.SafeAnswer = []byte{}
			}
			iNdEx = postIndex
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field SafeBindTime", wireType)
			}
			m.SafeBindTime = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.SafeBindTime |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func (m *UserThirdBindProto) Unmarshal(dAtA []byte) error {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		preIndex := iNdEx
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return ErrIntOverflowModel
			}
			if iNdEx >= l {
				return io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		fieldNum := int32(wire >> 3)
		wireType := int(wire & 0x7)
		if wireType == 4 {
			return fmt.Errorf("proto: UserThirdBindProto: wiretype end group for non-group")
		}
		if fieldNum <= 0 {
			return fmt.Errorf("proto: UserThirdBindProto: illegal tag %d (wire type %d)", fieldNum, wire)
		}
		switch fieldNum {
		case 1:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field ID", wireType)
			}
			m.ID = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.ID |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 2:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Mid", wireType)
			}
			m.Mid = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Mid |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 3:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field OpenID", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.OpenID = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 4:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field PlatForm", wireType)
			}
			m.PlatForm = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.PlatForm |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		case 5:
			if wireType != 2 {
				return fmt.Errorf("proto: wrong wireType = %d for field Token", wireType)
			}
			var stringLen uint64
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				stringLen |= (uint64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			intStringLen := int(stringLen)
			if intStringLen < 0 {
				return ErrInvalidLengthModel
			}
			postIndex := iNdEx + intStringLen
			if postIndex > l {
				return io.ErrUnexpectedEOF
			}
			m.Token = string(dAtA[iNdEx:postIndex])
			iNdEx = postIndex
		case 6:
			if wireType != 0 {
				return fmt.Errorf("proto: wrong wireType = %d for field Expires", wireType)
			}
			m.Expires = 0
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return ErrIntOverflowModel
				}
				if iNdEx >= l {
					return io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				m.Expires |= (int64(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
		default:
			iNdEx = preIndex
			skippy, err := skipModel(dAtA[iNdEx:])
			if err != nil {
				return err
			}
			if skippy < 0 {
				return ErrInvalidLengthModel
			}
			if (iNdEx + skippy) > l {
				return io.ErrUnexpectedEOF
			}
			iNdEx += skippy
		}
	}

	if iNdEx > l {
		return io.ErrUnexpectedEOF
	}
	return nil
}
func skipModel(dAtA []byte) (n int, err error) {
	l := len(dAtA)
	iNdEx := 0
	for iNdEx < l {
		var wire uint64
		for shift := uint(0); ; shift += 7 {
			if shift >= 64 {
				return 0, ErrIntOverflowModel
			}
			if iNdEx >= l {
				return 0, io.ErrUnexpectedEOF
			}
			b := dAtA[iNdEx]
			iNdEx++
			wire |= (uint64(b) & 0x7F) << shift
			if b < 0x80 {
				break
			}
		}
		wireType := int(wire & 0x7)
		switch wireType {
		case 0:
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return 0, ErrIntOverflowModel
				}
				if iNdEx >= l {
					return 0, io.ErrUnexpectedEOF
				}
				iNdEx++
				if dAtA[iNdEx-1] < 0x80 {
					break
				}
			}
			return iNdEx, nil
		case 1:
			iNdEx += 8
			return iNdEx, nil
		case 2:
			var length int
			for shift := uint(0); ; shift += 7 {
				if shift >= 64 {
					return 0, ErrIntOverflowModel
				}
				if iNdEx >= l {
					return 0, io.ErrUnexpectedEOF
				}
				b := dAtA[iNdEx]
				iNdEx++
				length |= (int(b) & 0x7F) << shift
				if b < 0x80 {
					break
				}
			}
			iNdEx += length
			if length < 0 {
				return 0, ErrInvalidLengthModel
			}
			return iNdEx, nil
		case 3:
			for {
				var innerWire uint64
				var start int = iNdEx
				for shift := uint(0); ; shift += 7 {
					if shift >= 64 {
						return 0, ErrIntOverflowModel
					}
					if iNdEx >= l {
						return 0, io.ErrUnexpectedEOF
					}
					b := dAtA[iNdEx]
					iNdEx++
					innerWire |= (uint64(b) & 0x7F) << shift
					if b < 0x80 {
						break
					}
				}
				innerWireType := int(innerWire & 0x7)
				if innerWireType == 4 {
					break
				}
				next, err := skipModel(dAtA[start:])
				if err != nil {
					return 0, err
				}
				iNdEx = start + next
			}
			return iNdEx, nil
		case 4:
			return iNdEx, nil
		case 5:
			iNdEx += 4
			return iNdEx, nil
		default:
			return 0, fmt.Errorf("proto: illegal wireType %d", wireType)
		}
	}
	panic("unreachable")
}

var (
	ErrInvalidLengthModel = fmt.Errorf("proto: negative length found during unmarshaling")
	ErrIntOverflowModel   = fmt.Errorf("proto: integer overflow")
)

func init() { proto.RegisterFile("model.proto", fileDescriptorModel) }

var fileDescriptorModel = []byte{
	// 791 bytes of a gzipped FileDescriptorProto
	0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0xac, 0x55, 0xcd, 0x6e, 0xeb, 0x44,
	0x14, 0xc6, 0x49, 0x9c, 0x9f, 0x49, 0xd2, 0x0a, 0x23, 0x20, 0x45, 0x28, 0xae, 0x8c, 0x8a, 0xca,
	0x82, 0x74, 0x51, 0x81, 0xc4, 0xb2, 0x4e, 0x5b, 0x29, 0x48, 0xa8, 0x61, 0x12, 0x58, 0xb0, 0x89,
	0x9c, 0x78, 0xec, 0x0e, 0xb5, 0x3d, 0x66, 0x66, 0x42, 0xe9, 0x7b, 0xb0, 0xe0, 0x1d, 0x90, 0x90,
	0x60, 0xc7, 0x1b, 0xb0, 0x44, 0xec, 0xb1, 0xae, 0x7a, 0x77, 0xd6, 0x7d, 0x88, 0xab, 0x39, 0x33,
	0x69, 0xd2, 0xaa, 0x55, 0x2a, 0xdd, 0xbb, 0xb3, 0xbf, 0xef, 0x3b, 0xe7, 0x7c, 0x67, 0xce, 0x1c,
	0x1b, 0xb5, 0x53, 0x16, 0x92, 0x64, 0x90, 0x73, 0x26, 0x99, 0xd3, 0xcb, 0x03, 0x21, 0x72, 0xc6,
	0xe5, 0x80, 0x66, 0x92, 0xf0, 0x28, 0x58, 0x90, 0x41, 0xc2, 0x62, 0x9a, 0x7d, 0xf4, 0x79, 0x4c,
	0xe5, 0xe5, 0x72, 0x3e, 0x58, 0xb0, 0xf4, 0x28, 0x66, 0x31, 0x3b, 0x82, 0x80, 0xf9, 0x32, 0x82,
	0x37, 0x78, 0x81, 0x27, 0x9d, 0xc8, 0xfb, 0xcb, 0x42, 0xed, 0x21, 0x63, 0x57, 0x94, 0x8c, 0x21,
	0xf1, 0x1e, 0xaa, 0x7e, 0x43, 0xc3, 0x9e, 0xb5, 0x6f, 0x1d, 0x56, 0xfd, 0x46, 0x59, 0xb8, 0xd5,
	0x94, 0x86, 0x58, 0x61, 0xce, 0x01, 0x6a, 0x4c, 0x88, 0x10, 0x94, 0x65, 0xbd, 0xca, 0xbe, 0x75,
	0xd8, 0xf2, 0xdb, 0x65, 0xe1, 0x36, 0x84, 0x86, 0xf0, 0x8a, 0x73, 0x3e, 0x46, 0xb5, 0xe1, 0x04,
	0x9f, 0xf7, 0xaa, 0xa0, 0x69, 0x96, 0x85, 0x5b, 0x5b, 0x08, 0x1e, 0x61, 0x40, 0x15, 0x3b, 0xbd,
	0xc9, 0x49, 0xaf, 0x06, 0x05, 0x80, 0x95, 0x37, 0x39, 0xc1, 0x80, 0xaa, 0x12, 0x67, 0xbf, 0xe4,
	0x94, 0x13, 0xd1, 0xb3, 0x41, 0x00, 0x25, 0x88, 0x86, 0xf0, 0x8a, 0xf3, 0xfe, 0xb0, 0x10, 0x9a,
	0xb2, 0x2b, 0x92, 0x6d, 0xf5, 0xec, 0x22, 0xfb, 0x24, 0xcf, 0x47, 0xa7, 0xe0, 0xb8, 0xea, 0xb7,
	0xca, 0xc2, 0xb5, 0x83, 0x3c, 0xa7, 0x21, 0xd6, 0xb8, 0x12, 0x40, 0x26, 0x63, 0x17, 0x04, 0x52,
	0x01, 0x58, 0xe3, 0x6f, 0xc7, 0xf0, 0xdf, 0x16, 0xea, 0x60, 0x12, 0x71, 0x22, 0x2e, 0xdf, 0xdc,
	0xf2, 0x01, 0x6a, 0x98, 0x5c, 0xc6, 0x34, 0xd4, 0xe4, 0x1a, 0xc2, 0x2b, 0x6e, 0xdd, 0x59, 0xed,
	0x89, 0xce, 0x9e, 0xe9, 0xfd, 0x77, 0x0b, 0x75, 0xbf, 0x13, 0x84, 0xfb, 0x81, 0xd8, 0x7e, 0x47,
	0x3c, 0x54, 0x57, 0x5a, 0xe3, 0xbe, 0xe5, 0xa3, 0xb2, 0x70, 0xeb, 0x4b, 0x41, 0x38, 0x0d, 0xb1,
	0x61, 0x54, 0xf8, 0xf8, 0x3a, 0x04, 0xef, 0x1d, 0x1d, 0x9e, 0x5f, 0x87, 0x58, 0x61, 0xea, 0xb0,
	0x27, 0x41, 0x22, 0x8d, 0x65, 0x38, 0x6c, 0x11, 0x24, 0x12, 0x03, 0xaa, 0x92, 0x4f, 0x64, 0x20,
	0x97, 0xda, 0xaf, 0xad, 0x93, 0x0b, 0x40, 0xb0, 0x61, 0xbc, 0x3f, 0x2d, 0xb4, 0xa3, 0xea, 0x9c,
	0xa5, 0x01, 0x4d, 0x9e, 0x73, 0xd6, 0x20, 0x04, 0xb7, 0x1d, 0x7d, 0x46, 0x44, 0x01, 0x58, 0xe3,
	0xce, 0x21, 0x6a, 0x7e, 0x4f, 0x38, 0x8d, 0x28, 0xd1, 0x86, 0x6d, 0xbf, 0x53, 0x16, 0x6e, 0xf3,
	0x67, 0x83, 0xe1, 0x3b, 0xd6, 0xf9, 0x0a, 0x75, 0x21, 0xc4, 0xa7, 0x59, 0x38, 0xa5, 0xe9, 0xea,
	0xc2, 0xbc, 0x57, 0x16, 0xee, 0x2e, 0xa4, 0x9c, 0xcd, 0x69, 0x16, 0xce, 0x24, 0x4d, 0x09, 0xbe,
	0xaf, 0xf4, 0x7e, 0xb5, 0x50, 0x47, 0x79, 0x9e, 0x92, 0xed, 0x8e, 0xf7, 0x50, 0x75, 0x4a, 0x56,
	0x7e, 0x81, 0x92, 0x24, 0xc1, 0x0a, 0x53, 0xd4, 0x90, 0x86, 0xe6, 0x4e, 0x00, 0xb5, 0x50, 0x51,
	0x43, 0x1a, 0x3a, 0xc7, 0xa8, 0x3d, 0x25, 0x0f, 0xad, 0xbd, 0x5b, 0x16, 0x6e, 0x57, 0x92, 0x4d,
	0x63, 0x9b, 0x2a, 0xef, 0x95, 0x85, 0x1c, 0x65, 0x0b, 0x93, 0xf8, 0x82, 0xd3, 0x98, 0x6e, 0xdf,
	0xb6, 0x4f, 0x50, 0xfd, 0x6b, 0x46, 0xb3, 0xd1, 0xd8, 0xdc, 0x5d, 0xb8, 0x50, 0x3f, 0x32, 0x9a,
	0xcd, 0x68, 0x8e, 0x0d, 0xe5, 0x7c, 0x86, 0x9a, 0xea, 0x09, 0x8c, 0x54, 0x41, 0xd6, 0x2d, 0x0b,
	0xb7, 0x05, 0x32, 0x30, 0x71, 0x47, 0xab, 0x81, 0xeb, 0xca, 0xe0, 0xd8, 0x0c, 0x9c, 0x01, 0x82,
	0x0d, 0xe3, 0x7c, 0xaa, 0xb6, 0x21, 0x86, 0x15, 0xb5, 0xd7, 0x03, 0xe2, 0x24, 0x9e, 0xc1, 0x9a,
	0xae, 0xc8, 0xf5, 0x5a, 0xd5, 0x1f, 0x5f, 0x2b, 0xef, 0x3f, 0x0b, 0xbd, 0xaf, 0xda, 0x9d, 0x04,
	0x11, 0xf9, 0x76, 0x49, 0x84, 0xa4, 0x6c, 0x7b, 0xc7, 0x5f, 0xa0, 0xce, 0xa6, 0x1e, 0xfa, 0xb6,
	0xf5, 0xc9, 0x8a, 0x20, 0x22, 0xb3, 0x9f, 0x0c, 0x81, 0xef, 0xc9, 0x9c, 0x23, 0x84, 0xd4, 0xfb,
	0x49, 0x26, 0xae, 0x09, 0x37, 0x9b, 0xb0, 0x5b, 0x16, 0x6e, 0x1b, 0x82, 0x02, 0x80, 0xf1, 0x86,
	0xc4, 0xf9, 0x52, 0xd7, 0x79, 0x30, 0x41, 0xa7, 0x2c, 0xdc, 0x1d, 0x08, 0x59, 0x8f, 0xf0, 0x9e,
	0xce, 0xfb, 0xdf, 0xcc, 0x70, 0x7a, 0x49, 0x79, 0xa8, 0x50, 0xdd, 0xd1, 0x07, 0xa8, 0x32, 0x3a,
	0x35, 0x0d, 0xd5, 0xcb, 0xc2, 0xad, 0xd0, 0x10, 0x57, 0xf4, 0x6a, 0xaa, 0x4e, 0x2b, 0x8f, 0x6f,
	0xf6, 0x45, 0x4e, 0xb2, 0xd1, 0xa9, 0xb9, 0x60, 0x7a, 0x16, 0x39, 0xc9, 0xd4, 0x66, 0x6b, 0x46,
	0x6d, 0xcb, 0x38, 0x09, 0xe4, 0x39, 0xe3, 0xa9, 0x71, 0x08, 0xc3, 0xc8, 0x93, 0x40, 0x46, 0x8c,
	0xa7, 0xf8, 0x8e, 0x5d, 0x7f, 0x9c, 0xec, 0xed, 0x1f, 0xa7, 0xfa, 0xd3, 0x1f, 0x27, 0xff, 0xc3,
	0x7f, 0x6e, 0xfb, 0xd6, 0xbf, 0xb7, 0x7d, 0xeb, 0xc5, 0x6d, 0xdf, 0xfa, 0xed, 0x65, 0xff, 0x9d,
	0x1f, 0x6c, 0xf8, 0x4d, 0xce, 0xeb, 0xf0, 0x7b, 0x3b, 0x7e, 0x1d, 0x00, 0x00, 0xff, 0xff, 0x9d,
	0x15, 0x68, 0xd9, 0x36, 0x07, 0x00, 0x00,
}
